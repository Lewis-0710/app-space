import{l as n,r as l,a as h}from"./loginApi.0a1a2ca2.js";import{n as u,F as c,G as g,x as p}from"./index.9611ac3a.js";var m=function(){var e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"user"},[s("div",{staticClass:"user-right"},[s("div",{staticClass:"user-login-panel"},[e.showType==="login"?s("div",{staticClass:"user-login-title"},[s("p",[e._v(" \u767B\u5F55")])]):e._e(),e.showType==="register"?s("div",{staticClass:"user-login-title"},[s("p",[e._v(" \u6CE8\u518C")])]):e._e(),e.showType==="forget"?s("div",{staticClass:"user-login-title"},[s("p",[e._v("\u627E\u56DE\u5BC6\u7801")])]):e._e(),s("div",{class:[e.showType==="login"?"user-login-form":"user-register-form"]},[s("el-input",{staticClass:"user-login-form-input",attrs:{type:"text",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D","prefix-icon":"icon-ic_name"},model:{value:e.username,callback:function(o){e.username=o},expression:"username"}}),e.showType==="register"?s("el-input",{staticClass:"user-login-form-input",attrs:{placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",type:"email","prefix-icon":"icon-ic_email"},model:{value:e.email,callback:function(o){e.email=o},expression:"email"}}):e._e(),s("el-input",{staticClass:"user-login-form-input",attrs:{placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password","prefix-icon":"icon-ic_pswd"},model:{value:e.password,callback:function(o){e.password=o},expression:"password"}}),s("el-button",{class:[e.showType==="login"?"user-login-form-btn":"user-register-form-btn"],attrs:{type:"submit",loading:e.showLoading},on:{click:e.onSubmit}},[e._v(e._s(e.showType==="login"?"\u7ACB\u5373\u767B\u5F55":"\u7ACB\u5373\u6CE8\u518C")+" ")]),e.showType==="login"?s("div",{staticClass:"user-login-form-label"},[s("p",[s("span",{on:{click:e.onRegister}},[e._v("\u6CA1\u6709\u8D26\u53F7\uFF1F\u7ACB\u5373\u6CE8\u518C")])])]):e._e(),e.showType==="register"?s("div",{staticClass:"user-login-form-label"},[s("p",[s("span",{on:{click:e.onRegister}},[e._v("\u5DF2\u6709\u8D26\u53F7\uFF1F\u73B0\u5728\u767B\u5F55")])])]):e._e(),s("div",{staticClass:"user-login-form-label user-login-form-bottom"},[s("p",{on:{click:e.onForget}},[e._v("\u5FD8\u8BB0\u5BC6\u7801")])])],1)])])])},d=[];const f={data(){return{username:"",password:"",isLogin:!1,errorInfo:"",showType:"login",email:"",showLoading:!1}},created(){this.$nextTick(()=>{})},components:{},methods:{onSubmit(){this.showType==="login"?this.login():this.showType==="register"?this.regist():this.requestPassword()},onRegister(){this.showType=this.showType==="register"?"login":"register"},onForget(){this.$prompt("\u8BF7\u8F93\u5165\u90AE\u7BB1,\u6211\u4EEC\u4F1A\u53D1\u9001\u65B0\u5BC6\u7801\u5230\u60A8\u5230\u90AE\u7BB1","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputPattern:/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/,inputErrorMessage:"\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E"}).then(({value:t})=>{this.email=t,this.requestPassword()}).catch(t=>{this.$message({type:"info",message:t})})},login(){if(this.username.length===0){this.errorInfo="* \u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A";return}if(this.password.length===0){this.errorInfo="* \u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A";return}this.errorInfo="";let t={username:this.username,password:this.password};this.showLoading=!0,n(t).then(e=>{console.log(e),this.showLoading=!1,c.add(this.axios.baseURL,e.data.token);let i={userName:this.username,userId:e.data._id,permission:e.data.permission,email:e.data.email,apiToken:e.data.apiToken};g(i),this.$router.push("/")},e=>{this.showLoading=!1})},regist(){if(this.username.length===0){this.$message.error("\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A");return}if(this.email.length===0){this.$message.error("\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A");return}if(!p.valideEmail(this.email)){this.$message.error("\u90AE\u7BB1\u683C\u5F0F\u9519\u8BEF");return}if(this.password.length===0){this.$message.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}let t={username:this.username,password:this.password,email:this.email};this.showLoading=!0,l(t).then(e=>{this.showLoading=!1,console.log(e),this.$message({message:"\u606D\u559C\u4F60\uFF0C\u6CE8\u518C\u6210\u529F",type:"success"}),setTimeout(()=>{this.onRegister()},500)},e=>{this.showLoading=!1})},requestPassword(){if(this.email.length===0){this.$message.error("\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A");return}h({email:this.email}).then(t=>{console.log(t),this.$message({message:"\u5BC6\u7801\u5DF2\u91CD\u7F6E,\u65B0\u5BC6\u7801\u5DF2\u901A\u8FC7\u90AE\u4EF6\u53D1\u9001\u81F3\u60A8\u7684\u90AE\u7BB1.",type:"success"})},t=>{console.log(t),this.$message.error(t)})},clickSubItem(t){if(t==="api"){let e=`${this.axios.defaults.baseURL}api/swagger`;window.open(e,"_blank")}if(t==="help"){let i=`http://wiki.${this.axios.defaults.baseURL.replace("https://","").replace("http://","").replace("www.","")}`;console.log(i),window.open(i,"_blank")}if(t==="github"){let e="https://github.com/HeadingMobile";window.open(e,"_blank")}t.index}}},a={};var w=u(f,m,d,!1,_,null,null,null);function _(t){for(let e in a)this[e]=a[e]}var y=function(){return w.exports}();export{y as default};
