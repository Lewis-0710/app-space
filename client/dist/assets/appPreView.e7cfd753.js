import{n as p,I as h,i as I,a as v,r as _,b as c}from"./index.9611ac3a.js";import{V as w}from"./vue-qr.01b3d2cc.js";var g=function(){var s=this,t=this,r=t.$createElement,o=t._self._c||r;return o("div",{staticClass:"preview-app-wrapper"},[t.dataInfo.length>0?o("div",{staticClass:"phoneDownLoadWrapper"},[o("img",{staticClass:"app-icon",attrs:{src:this.curInfo.appInfo.icon||"",alt:""},on:{error:function(a){return t.setDefaultIcon(a,s.curInfo.appInfo)}}}),o("p",{staticClass:"title"},[t._v(t._s(this.curInfo.appInfo.appName))]),this.curInfo.appInfo.platform!="rn"?o("div",{staticClass:"info"},[o("p",{staticClass:"desc"},[t._v("\u7248\u672C\uFF1A"+t._s(this.curInfo.versionInfo.versionName)+"("+t._s(this.curInfo.versionInfo.versionCode)+")")]),o("span",[t._v("\u5927\u5C0F\uFF1A"+t._s((this.curInfo.versionInfo.size/1024/1024).toFixed(1))+"M")])]):t._e(),this.curInfo.appInfo.platform=="rn"?o("div",{staticClass:"info"},[o("p",{staticClass:"desc"},[t._v("\u7248\u672C\uFF1A"+t._s(this.curInfo.versionInfo.appVersion))]),o("span",[t._v("\u5927\u5C0F\uFF1A"+t._s((this.curInfo.versionInfo.size/1024/1024).toFixed(2))+"M")])]):t._e(),o("p",{staticClass:"info"},[t._v("\u53D1\u5E03\u65E5\u671F\uFF1A "+t._s(t.formatDate(this.curInfo.versionInfo.uploadAt))+" ")]),o("div",{staticClass:"qrcode"},[o("vue-qr",{staticClass:"qrcodeImg",attrs:{colorDark:"#585F69",text:t.qrCodeUrl,margin:15}}),o("p",{staticClass:"tips"},[t._v("\u7528\u624B\u673A\u626B\u63CF\u4E8C\u7EF4\u7801"+t._s(this.curInfo.appInfo.platform=="rn"?"\u4E0B\u8F7D":"\u5B89\u88C5"))])],1),t.showPasswordInput?o("div",[o("div",[o("el-input",{staticClass:"pwd",attrs:{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},model:{value:t.pwd,callback:function(a){t.pwd=a},expression:"pwd"}})],1),o("div",[o("el-button",{staticClass:"downloadBtn sureBtn",attrs:{loading:t.loading,type:"primary",round:""},on:{click:t.clickSure}},[t._v("\u786E\u5B9A")])],1)]):t._e(),t.curInfo.appInfo.platform!="rn"&&t.showDownLoadBtn?o("el-button",{staticClass:"downloadBtn",attrs:{type:"primary",round:""},on:{click:function(a){return t.clickDownLoadBtn(t.curInfo)}}},[o("i",{class:this.curInfo.appInfo.platform==="ios"?"icon-ic_ios":"icon-ic_andr"}),t._v(" \u4E0B\u8F7D\u5B89\u88C5")]):t._e(),t.curInfo.appInfo.platform=="rn"&&t.showDownLoadBtn?o("el-button",{staticClass:"downloadBtn",attrs:{type:"primary",round:""},on:{click:function(a){return t.clickDownLoadBtn(t.curInfo)}}},[t._v("\u4E0B\u8F7D")]):t._e()],1):t._e(),t.showMergeBtn?o("div",{staticClass:"merge-wrapper"},[o("div",{staticClass:"left"},[o("div",{staticClass:"info"},[o("p",{staticClass:"desc"},[t._v("\u7248\u672C\uFF1A"+t._s(t.dataInfo[0].versionInfo.versionName)+"("+t._s(t.dataInfo[0].versionInfo.versionCode)+")")]),o("span",[t._v("\u5927\u5C0F\uFF1A"+t._s((t.dataInfo[0].versionInfo.size/1024/1024).toFixed(1))+"M")])]),o("p",{staticClass:"info"},[t._v("\u53D1\u5E03\u65E5\u671F\uFF1A "+t._s(t.formatDate(t.dataInfo[0].versionInfo.uploadAt))+" ")]),o("el-button",{staticClass:"downloadBtn mergeDown",attrs:{type:"primary",round:""},on:{click:function(a){return t.clickDownLoadBtn(t.dataInfo[0])}}},[t._v(t._s("\u4E0B\u8F7D ".concat(t.dataInfo[0].appInfo.platform," \u7248")))])],1),o("div",{staticClass:"line"}),o("div",{staticClass:"right"},[o("div",{staticClass:"info"},[o("p",{staticClass:"desc"},[t._v("\u7248\u672C\uFF1A"+t._s(t.dataInfo[1].versionInfo.versionName)+"("+t._s(t.dataInfo[1].versionInfo.versionCode)+")")]),o("span",[t._v("\u5927\u5C0F\uFF1A"+t._s((t.dataInfo[1].versionInfo.size/1024/1024).toFixed(1))+"M")])]),o("p",{staticClass:"info"},[t._v("\u53D1\u5E03\u65E5\u671F\uFF1A "+t._s(t.formatDate(t.dataInfo[1].versionInfo.uploadAt))+" ")]),o("el-button",{staticClass:"downloadBtn mergeDown",attrs:{type:"primary",round:""},on:{click:function(a){return t.clickDownLoadBtn(t.dataInfo[1])}}},[t._v(t._s("\u4E0B\u8F7D ".concat(t.dataInfo[1].appInfo.platform," \u7248")))])],1)]):t._e(),t.showHistoryList?o("div",{staticClass:"history-wrapper"},[o("ul",t._l(this.curInfo.history,function(e,a){return o("li",{key:a,on:{click:function(d){return t.historyClickDownLoadBtn(e)}}},[t.curInfo.appInfo.platform!="rn"?o("div",[t._v("V"+t._s(e.versionName)+"(build "+t._s(e.versionCode)+")")]):t._e(),t.curInfo.appInfo.platform=="rn"?o("div",[t._v("V"+t._s(e.appVersion))]):t._e(),o("div",[t._v(t._s(t.formatTime(e.uploadAt)))])])}),0)]):t._e()])},m=[];const C={components:{VueQr:w},data(){return{dataInfo:[],curInfo:{appInfo:{},versionInfo:{},history:[]},qrCodeUrl:"",pwd:"",installWithPwd:!1,isPhone:!1,loading:!1}},computed:{isIos(){return!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)},isAndroid(){return!!navigator.userAgent.match(/(Android)\s+([\d.]+)/)},showDownLoadBtn(){return!this.showPasswordInput&&(this.isPhone||this.dataInfo.length==1)},showMergeBtn(){return!this.showPasswordInput&&!this.isPhone&&this.dataInfo.length>1},showPasswordInput(){return this.installWithPwd},showHistoryList(){return!this.showPasswordInput&&this.curInfo.history.length>0}},mounted(){this.getAppInfo(this.$route.params.id,this.pwd),this.isIos||this.isAndroid?this.isPhone=!0:this.isPhone=!1},created(){this.$nextTick(()=>{})},methods:{formatTime(n){return new Date(n).toFormat()},getTableBackground(n){return n%2===0?"backgroundColor: rgb(244, 245, 247)":"backgroundColor: white"},getAppInfo(n,s){h(n,s).then(t=>{if(console.log(t),t.data==null){this.$message.error("\u672A\u68C0\u6D4B\u5230\u7248\u672C\u4FE1\u606F");return}this.installWithPwd=t.data.needAuth,this.dataInfo=t.data.list,this.isPhone&&this.dataInfo.length>1?this.isAndroid&&this.dataInfo[0].appInfo.platform=="android"?this.curInfo=this.dataInfo[0]:this.curInfo=this.dataInfo[1]:this.curInfo=this.dataInfo[0],this.qrCodeUrl=`${window.origin}${this.$route.fullPath}`,this.loading=!1},t=>{this.loading=!1,this.pwd=""})},setDefaultIcon(n,s){s.platform=="ios"?n.target.src=I:s.platform=="android"?n.target.src=v:s.platform=="rn"&&(n.target.src=_)},historyClickDownLoadBtn(n){if(n.grayScaleLimit&&n.grayScaleSize<=n.downloadCount){this.$message.error("\u5DF2\u8FBE\u5230\u7070\u5EA6\u4E0A\u9650"),this.getAppInfo(this.$route.params.id,this.pwd);return}if(this.isIos){const s=document.createElement("a");s.setAttribute("href",n.installUrl),s.click()}else{const s=document.createElement("a");let t=n.downloadUrl;s.setAttribute("href",t),s.click(),fetch(t).then(r=>{let o=r.body.getReader(),a=r.headers.get("Content-Length"),i=0;o.read().then(function d(l){if(l.done){c(n._id).then(()=>{},u=>{});return}return i+=l.value.length,console.log(`progress: ${i/a*100}%`),o.read().then(d)})})}},clickDownLoadBtn(n){if(n.versionInfo.grayScaleLimit&&n.versionInfo.grayScaleSize<=n.versionInfo.downloadCount){this.$message.error("\u5DF2\u8FBE\u5230\u7070\u5EA6\u4E0A\u9650"),this.getAppInfo(this.$route.params.id,this.pwd);return}if(this.isIos){const s=document.createElement("a");s.setAttribute("href",n.versionInfo.installUrl),s.click()}else{const s=document.createElement("a");let t=n.versionInfo.downloadUrl;s.setAttribute("href",t),s.click(),fetch(t).then(r=>{let o=r.body.getReader(),a=r.headers.get("Content-Length"),i=0;o.read().then(function d(l){if(l.done){console.log("\u4E0B\u8F7D\u5B8C\u6210"),c(n.versionInfo._id).then(()=>{},u=>{});return}return i+=l.value.length,console.log(`progress: ${i/a*100}%`),o.read().then(d)})})}},formatDate(n){return n?new Date(n).toFormat():""},clickSure(){if(!this.pwd){this.$message.info("\u8BF7\u8F93\u5165\u5BC6\u7801");return}this.loading=!0,this.getAppInfo(this.$route.params.id,this.pwd)}}},f={};var k=p(C,g,m,!1,y,null,null,null);function y(n){for(let s in f)this[s]=f[s]}var B=function(){return k.exports}();export{B as default};
